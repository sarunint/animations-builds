{"version":3,"file":"animation_ast_builder.js","sourceRoot":"","sources":["../../../../../../../packages/animations/browser/src/dsl/animation_ast_builder.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AUTO_STYLE, AnimateTimings, AnimationAnimateChildMetadata, AnimationAnimateMetadata, AnimationAnimateRefMetadata, AnimationGroupMetadata, AnimationKeyframesSequenceMetadata, AnimationMetadata, AnimationMetadataType, AnimationOptions, AnimationQueryMetadata, AnimationQueryOptions, AnimationReferenceMetadata, AnimationSequenceMetadata, AnimationStaggerMetadata, AnimationStateMetadata, AnimationStyleMetadata, AnimationTransitionMetadata, AnimationTriggerMetadata, style, ɵStyleData} from '@angular/animations';\n\nimport {AnimationDriver} from '../render/animation_driver';\nimport {getOrSetAsInMap} from '../render/shared';\nimport {ENTER_SELECTOR, LEAVE_SELECTOR, NG_ANIMATING_SELECTOR, NG_TRIGGER_SELECTOR, SUBSTITUTION_EXPR_START, copyObj, extractStyleParams, iteratorToArray, normalizeAnimationEntry, resolveTiming, validateStyleParams, visitDslNode} from '../util';\n\nimport {AnimateAst, AnimateChildAst, AnimateRefAst, Ast, DynamicTimingAst, GroupAst, KeyframesAst, QueryAst, ReferenceAst, SequenceAst, StaggerAst, StateAst, StyleAst, TimingAst, TransitionAst, TriggerAst} from './animation_ast';\nimport {AnimationDslVisitor} from './animation_dsl_visitor';\nimport {parseTransitionExpr} from './animation_transition_expr';\n\nconst SELF_TOKEN = ':self';\nconst SELF_TOKEN_REGEX = new RegExp(`\\s*${SELF_TOKEN}\\s*,?`, 'g');\n\n/*\n * [Validation]\n * The visitor code below will traverse the animation AST generated by the animation verb functions\n * (the output is a tree of objects) and attempt to perform a series of validations on the data. The\n * following corner-cases will be validated:\n *\n * 1. Overlap of animations\n * Given that a CSS property cannot be animated in more than one place at the same time, it's\n * important that this behaviour is detected and validated. The way in which this occurs is that\n * each time a style property is examined, a string-map containing the property will be updated with\n * the start and end times for when the property is used within an animation step.\n *\n * If there are two or more parallel animations that are currently running (these are invoked by the\n * group()) on the same element then the validator will throw an error. Since the start/end timing\n * values are collected for each property then if the current animation step is animating the same\n * property and its timing values fall anywhere into the window of time that the property is\n * currently being animated within then this is what causes an error.\n *\n * 2. Timing values\n * The validator will validate to see if a timing value of `duration delay easing` or\n * `durationNumber` is valid or not.\n *\n * (note that upon validation the code below will replace the timing data with an object containing\n * {duration,delay,easing}.\n *\n * 3. Offset Validation\n * Each of the style() calls are allowed to have an offset value when placed inside of keyframes().\n * Offsets within keyframes() are considered valid when:\n *\n *   - No offsets are used at all\n *   - Each style() entry contains an offset value\n *   - Each offset is between 0 and 1\n *   - Each offset is greater to or equal than the previous one\n *\n * Otherwise an error will be thrown.\n */\nexport function buildAnimationAst(\n    driver: AnimationDriver, metadata: AnimationMetadata | AnimationMetadata[],\n    errors: any[]): Ast<AnimationMetadataType> {\n  return new AnimationAstBuilderVisitor(driver).build(metadata, errors);\n}\n\nconst ROOT_SELECTOR = '';\n\nexport class AnimationAstBuilderVisitor implements AnimationDslVisitor {\n  constructor(private _driver: AnimationDriver) {}\n\n  build(metadata: AnimationMetadata|AnimationMetadata[], errors: any[]):\n      Ast<AnimationMetadataType> {\n    const context = new AnimationAstBuilderContext(errors);\n    this._resetContextStyleTimingState(context);\n    return <Ast<AnimationMetadataType>>visitDslNode(\n        this, normalizeAnimationEntry(metadata), context);\n  }\n\n  private _resetContextStyleTimingState(context: AnimationAstBuilderContext) {\n    context.currentQuerySelector = ROOT_SELECTOR;\n    context.collectedStyles = {};\n    context.collectedStyles[ROOT_SELECTOR] = {};\n    context.currentTime = 0;\n  }\n\n  visitTrigger(metadata: AnimationTriggerMetadata, context: AnimationAstBuilderContext):\n      TriggerAst {\n    let queryCount = context.queryCount = 0;\n    let depCount = context.depCount = 0;\n    const states: StateAst[] = [];\n    const transitions: TransitionAst[] = [];\n    if (metadata.name.charAt(0) == '@') {\n      context.errors.push(\n          'animation triggers cannot be prefixed with an `@` sign (e.g. trigger(\\'@foo\\', [...]))');\n    }\n\n    metadata.definitions.forEach(def => {\n      this._resetContextStyleTimingState(context);\n      if (def.type == AnimationMetadataType.State) {\n        const stateDef = def as AnimationStateMetadata;\n        const name = stateDef.name;\n        name.toString().split(/\\s*,\\s*/).forEach(n => {\n          stateDef.name = n;\n          states.push(this.visitState(stateDef, context));\n        });\n        stateDef.name = name;\n      } else if (def.type == AnimationMetadataType.Transition) {\n        const transition = this.visitTransition(def as AnimationTransitionMetadata, context);\n        queryCount += transition.queryCount;\n        depCount += transition.depCount;\n        transitions.push(transition);\n      } else {\n        context.errors.push(\n            'only state() and transition() definitions can sit inside of a trigger()');\n      }\n    });\n\n    return {\n      type: AnimationMetadataType.Trigger,\n      name: metadata.name, states, transitions, queryCount, depCount,\n      options: null\n    };\n  }\n\n  visitState(metadata: AnimationStateMetadata, context: AnimationAstBuilderContext): StateAst {\n    const styleAst = this.visitStyle(metadata.styles, context);\n    const astParams = (metadata.options && metadata.options.params) || null;\n    if (styleAst.containsDynamicStyles) {\n      const missingSubs = new Set<string>();\n      const params = astParams || {};\n      styleAst.styles.forEach(value => {\n        if (isObject(value)) {\n          const stylesObj = value as any;\n          Object.keys(stylesObj).forEach(prop => {\n            extractStyleParams(stylesObj[prop]).forEach(sub => {\n              if (!params.hasOwnProperty(sub)) {\n                missingSubs.add(sub);\n              }\n            });\n          });\n        }\n      });\n      if (missingSubs.size) {\n        const missingSubsArr = iteratorToArray(missingSubs.values());\n        context.errors.push(\n            `state(\"${metadata.name}\", ...) must define default values for all the following style substitutions: ${missingSubsArr.join(', ')}`);\n      }\n    }\n\n    return {\n      type: AnimationMetadataType.State,\n      name: metadata.name,\n      style: styleAst,\n      options: astParams ? {params: astParams} : null\n    };\n  }\n\n  visitTransition(metadata: AnimationTransitionMetadata, context: AnimationAstBuilderContext):\n      TransitionAst {\n    context.queryCount = 0;\n    context.depCount = 0;\n    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n    const matchers = parseTransitionExpr(metadata.expr, context.errors);\n\n    return {\n      type: AnimationMetadataType.Transition,\n      matchers,\n      animation,\n      queryCount: context.queryCount,\n      depCount: context.depCount,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitSequence(metadata: AnimationSequenceMetadata, context: AnimationAstBuilderContext):\n      SequenceAst {\n    return {\n      type: AnimationMetadataType.Sequence,\n      steps: metadata.steps.map(s => visitDslNode(this, s, context)),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitGroup(metadata: AnimationGroupMetadata, context: AnimationAstBuilderContext): GroupAst {\n    const currentTime = context.currentTime;\n    let furthestTime = 0;\n    const steps = metadata.steps.map(step => {\n      context.currentTime = currentTime;\n      const innerAst = visitDslNode(this, step, context);\n      furthestTime = Math.max(furthestTime, context.currentTime);\n      return innerAst;\n    });\n\n    context.currentTime = furthestTime;\n    return {\n      type: AnimationMetadataType.Group,\n      steps,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimate(metadata: AnimationAnimateMetadata, context: AnimationAstBuilderContext):\n      AnimateAst {\n    const timingAst = constructTimingAst(metadata.timings, context.errors);\n    context.currentAnimateTimings = timingAst;\n\n    let styleAst: StyleAst|KeyframesAst;\n    let styleMetadata: AnimationMetadata = metadata.styles ? metadata.styles : style({});\n    if (styleMetadata.type == AnimationMetadataType.Keyframes) {\n      styleAst = this.visitKeyframes(styleMetadata as AnimationKeyframesSequenceMetadata, context);\n    } else {\n      let styleMetadata = metadata.styles as AnimationStyleMetadata;\n      let isEmpty = false;\n      if (!styleMetadata) {\n        isEmpty = true;\n        const newStyleData: {[prop: string]: string | number} = {};\n        if (timingAst.easing) {\n          newStyleData['easing'] = timingAst.easing;\n        }\n        styleMetadata = style(newStyleData);\n      }\n      context.currentTime += timingAst.duration + timingAst.delay;\n      const _styleAst = this.visitStyle(styleMetadata, context);\n      _styleAst.isEmptyStep = isEmpty;\n      styleAst = _styleAst;\n    }\n\n    context.currentAnimateTimings = null;\n    return {\n      type: AnimationMetadataType.Animate,\n      timings: timingAst,\n      style: styleAst,\n      options: null\n    };\n  }\n\n  visitStyle(metadata: AnimationStyleMetadata, context: AnimationAstBuilderContext): StyleAst {\n    const ast = this._makeStyleAst(metadata, context);\n    this._validateStyleAst(ast, context);\n    return ast;\n  }\n\n  private _makeStyleAst(metadata: AnimationStyleMetadata, context: AnimationAstBuilderContext):\n      StyleAst {\n    const styles: (ɵStyleData | string)[] = [];\n    if (Array.isArray(metadata.styles)) {\n      (metadata.styles as(ɵStyleData | string)[]).forEach(styleTuple => {\n        if (typeof styleTuple == 'string') {\n          if (styleTuple == AUTO_STYLE) {\n            styles.push(styleTuple as string);\n          } else {\n            context.errors.push(`The provided style string value ${styleTuple} is not allowed.`);\n          }\n        } else {\n          styles.push(styleTuple as ɵStyleData);\n        }\n      });\n    } else {\n      styles.push(metadata.styles);\n    }\n\n    let containsDynamicStyles = false;\n    let collectedEasing: string|null = null;\n    styles.forEach(styleData => {\n      if (isObject(styleData)) {\n        const styleMap = styleData as ɵStyleData;\n        const easing = styleMap['easing'];\n        if (easing) {\n          collectedEasing = easing as string;\n          delete styleMap['easing'];\n        }\n        if (!containsDynamicStyles) {\n          for (let prop in styleMap) {\n            const value = styleMap[prop];\n            if (value.toString().indexOf(SUBSTITUTION_EXPR_START) >= 0) {\n              containsDynamicStyles = true;\n              break;\n            }\n          }\n        }\n      }\n    });\n\n    return {\n      type: AnimationMetadataType.Style,\n      styles,\n      easing: collectedEasing,\n      offset: metadata.offset, containsDynamicStyles,\n      options: null\n    };\n  }\n\n  private _validateStyleAst(ast: StyleAst, context: AnimationAstBuilderContext): void {\n    const timings = context.currentAnimateTimings;\n    let endTime = context.currentTime;\n    let startTime = context.currentTime;\n    if (timings && startTime > 0) {\n      startTime -= timings.duration + timings.delay;\n    }\n\n    ast.styles.forEach(tuple => {\n      if (typeof tuple == 'string') return;\n\n      Object.keys(tuple).forEach(prop => {\n        if (!this._driver.validateStyleProperty(prop)) {\n          context.errors.push(\n              `The provided animation property \"${prop}\" is not a supported CSS property for animations`);\n          return;\n        }\n\n        const collectedStyles = context.collectedStyles[context.currentQuerySelector !];\n        const collectedEntry = collectedStyles[prop];\n        let updateCollectedStyle = true;\n        if (collectedEntry) {\n          if (startTime != endTime && startTime >= collectedEntry.startTime &&\n              endTime <= collectedEntry.endTime) {\n            context.errors.push(\n                `The CSS property \"${prop}\" that exists between the times of \"${collectedEntry.startTime}ms\" and \"${collectedEntry.endTime}ms\" is also being animated in a parallel animation between the times of \"${startTime}ms\" and \"${endTime}ms\"`);\n            updateCollectedStyle = false;\n          }\n\n          // we always choose the smaller start time value since we\n          // want to have a record of the entire animation window where\n          // the style property is being animated in between\n          startTime = collectedEntry.startTime;\n        }\n\n        if (updateCollectedStyle) {\n          collectedStyles[prop] = {startTime, endTime};\n        }\n\n        if (context.options) {\n          validateStyleParams(tuple[prop], context.options, context.errors);\n        }\n      });\n    });\n  }\n\n  visitKeyframes(metadata: AnimationKeyframesSequenceMetadata, context: AnimationAstBuilderContext):\n      KeyframesAst {\n    const ast: KeyframesAst = {type: AnimationMetadataType.Keyframes, styles: [], options: null};\n    if (!context.currentAnimateTimings) {\n      context.errors.push(`keyframes() must be placed inside of a call to animate()`);\n      return ast;\n    }\n\n    const MAX_KEYFRAME_OFFSET = 1;\n\n    let totalKeyframesWithOffsets = 0;\n    const offsets: number[] = [];\n    let offsetsOutOfOrder = false;\n    let keyframesOutOfRange = false;\n    let previousOffset: number = 0;\n\n    const keyframes: StyleAst[] = metadata.steps.map(styles => {\n      const style = this._makeStyleAst(styles, context);\n      let offsetVal: number|null =\n          style.offset != null ? style.offset : consumeOffset(style.styles);\n      let offset: number = 0;\n      if (offsetVal != null) {\n        totalKeyframesWithOffsets++;\n        offset = style.offset = offsetVal;\n      }\n      keyframesOutOfRange = keyframesOutOfRange || offset < 0 || offset > 1;\n      offsetsOutOfOrder = offsetsOutOfOrder || offset < previousOffset;\n      previousOffset = offset;\n      offsets.push(offset);\n      return style;\n    });\n\n    if (keyframesOutOfRange) {\n      context.errors.push(`Please ensure that all keyframe offsets are between 0 and 1`);\n    }\n\n    if (offsetsOutOfOrder) {\n      context.errors.push(`Please ensure that all keyframe offsets are in order`);\n    }\n\n    const length = metadata.steps.length;\n    let generatedOffset = 0;\n    if (totalKeyframesWithOffsets > 0 && totalKeyframesWithOffsets < length) {\n      context.errors.push(`Not all style() steps within the declared keyframes() contain offsets`);\n    } else if (totalKeyframesWithOffsets == 0) {\n      generatedOffset = MAX_KEYFRAME_OFFSET / (length - 1);\n    }\n\n    const limit = length - 1;\n    const currentTime = context.currentTime;\n    const currentAnimateTimings = context.currentAnimateTimings !;\n    const animateDuration = currentAnimateTimings.duration;\n    keyframes.forEach((kf, i) => {\n      const offset = generatedOffset > 0 ? (i == limit ? 1 : (generatedOffset * i)) : offsets[i];\n      const durationUpToThisFrame = offset * animateDuration;\n      context.currentTime = currentTime + currentAnimateTimings.delay + durationUpToThisFrame;\n      currentAnimateTimings.duration = durationUpToThisFrame;\n      this._validateStyleAst(kf, context);\n      kf.offset = offset;\n\n      ast.styles.push(kf);\n    });\n\n    return ast;\n  }\n\n  visitReference(metadata: AnimationReferenceMetadata, context: AnimationAstBuilderContext):\n      ReferenceAst {\n    return {\n      type: AnimationMetadataType.Reference,\n      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimateChild(metadata: AnimationAnimateChildMetadata, context: AnimationAstBuilderContext):\n      AnimateChildAst {\n    context.depCount++;\n    return {\n      type: AnimationMetadataType.AnimateChild,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimateRef(metadata: AnimationAnimateRefMetadata, context: AnimationAstBuilderContext):\n      AnimateRefAst {\n    return {\n      type: AnimationMetadataType.AnimateRef,\n      animation: this.visitReference(metadata.animation, context),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitQuery(metadata: AnimationQueryMetadata, context: AnimationAstBuilderContext): QueryAst {\n    const parentSelector = context.currentQuerySelector !;\n    const options = (metadata.options || {}) as AnimationQueryOptions;\n\n    context.queryCount++;\n    context.currentQuery = metadata;\n    const [selector, includeSelf] = normalizeSelector(metadata.selector);\n    context.currentQuerySelector =\n        parentSelector.length ? (parentSelector + ' ' + selector) : selector;\n    getOrSetAsInMap(context.collectedStyles, context.currentQuerySelector, {});\n\n    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n    context.currentQuery = null;\n    context.currentQuerySelector = parentSelector;\n\n    return {\n      type: AnimationMetadataType.Query,\n      selector,\n      limit: options.limit || 0,\n      optional: !!options.optional, includeSelf, animation,\n      originalSelector: metadata.selector,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitStagger(metadata: AnimationStaggerMetadata, context: AnimationAstBuilderContext):\n      StaggerAst {\n    if (!context.currentQuery) {\n      context.errors.push(`stagger() can only be used inside of query()`);\n    }\n    const timings = metadata.timings === 'full' ?\n        {duration: 0, delay: 0, easing: 'full'} :\n        resolveTiming(metadata.timings, context.errors, true);\n\n    return {\n      type: AnimationMetadataType.Stagger,\n      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context), timings,\n      options: null\n    };\n  }\n}\n\nfunction normalizeSelector(selector: string): [string, boolean] {\n  const hasAmpersand = selector.split(/\\s*,\\s*/).find(token => token == SELF_TOKEN) ? true : false;\n  if (hasAmpersand) {\n    selector = selector.replace(SELF_TOKEN_REGEX, '');\n  }\n\n  // the :enter and :leave selectors are filled in at runtime during timeline building\n  selector = selector.replace(/@\\*/g, NG_TRIGGER_SELECTOR)\n                 .replace(/@\\w+/g, match => NG_TRIGGER_SELECTOR + '-' + match.substr(1))\n                 .replace(/:animating/g, NG_ANIMATING_SELECTOR);\n\n  return [selector, hasAmpersand];\n}\n\n\nfunction normalizeParams(obj: {[key: string]: any} | any): {[key: string]: any}|null {\n  return obj ? copyObj(obj) : null;\n}\n\nexport type StyleTimeTuple = {\n  startTime: number; endTime: number;\n};\n\nexport class AnimationAstBuilderContext {\n  public queryCount: number = 0;\n  public depCount: number = 0;\n  public currentTransition: AnimationTransitionMetadata|null = null;\n  public currentQuery: AnimationQueryMetadata|null = null;\n  public currentQuerySelector: string|null = null;\n  public currentAnimateTimings: TimingAst|null = null;\n  public currentTime: number = 0;\n  public collectedStyles: {[selectorName: string]: {[propName: string]: StyleTimeTuple}} = {};\n  public options: AnimationOptions|null = null;\n  constructor(public errors: any[]) {}\n}\n\nfunction consumeOffset(styles: ɵStyleData | string | (ɵStyleData | string)[]): number|null {\n  if (typeof styles == 'string') return null;\n\n  let offset: number|null = null;\n\n  if (Array.isArray(styles)) {\n    styles.forEach(styleTuple => {\n      if (isObject(styleTuple) && styleTuple.hasOwnProperty('offset')) {\n        const obj = styleTuple as ɵStyleData;\n        offset = parseFloat(obj['offset'] as string);\n        delete obj['offset'];\n      }\n    });\n  } else if (isObject(styles) && styles.hasOwnProperty('offset')) {\n    const obj = styles as ɵStyleData;\n    offset = parseFloat(obj['offset'] as string);\n    delete obj['offset'];\n  }\n  return offset;\n}\n\nfunction isObject(value: any): boolean {\n  return !Array.isArray(value) && typeof value == 'object';\n}\n\nfunction constructTimingAst(value: string | number | AnimateTimings, errors: any[]) {\n  let timings: AnimateTimings|null = null;\n  if (value.hasOwnProperty('duration')) {\n    timings = value as AnimateTimings;\n  } else if (typeof value == 'number') {\n    const duration = resolveTiming(value as number, errors).duration;\n    return makeTimingAst(duration as number, 0, '');\n  }\n\n  const strValue = value as string;\n  const isDynamic = strValue.split(/\\s+/).some(v => v.charAt(0) == '{' && v.charAt(1) == '{');\n  if (isDynamic) {\n    const ast = makeTimingAst(0, 0, '') as any;\n    ast.dynamic = true;\n    ast.strValue = strValue;\n    return ast as DynamicTimingAst;\n  }\n\n  timings = timings || resolveTiming(strValue, errors);\n  return makeTimingAst(timings.duration, timings.delay, timings.easing);\n}\n\nfunction normalizeAnimationOptions(options: AnimationOptions | null): AnimationOptions {\n  if (options) {\n    options = copyObj(options);\n    if (options['params']) {\n      options['params'] = normalizeParams(options['params']) !;\n    }\n  } else {\n    options = {};\n  }\n  return options;\n}\n\nfunction makeTimingAst(duration: number, delay: number, easing: string | null): TimingAst {\n  return {duration, delay, easing};\n}\n"]}