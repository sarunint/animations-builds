{"version":3,"file":"animation_engine_next.js","sourceRoot":"","sources":["../../../../../../../packages/animations/browser/src/render/animation_engine_next.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimationMetadata, AnimationPlayer, AnimationTriggerMetadata} from '@angular/animations';\nimport {TriggerAst} from '../dsl/animation_ast';\nimport {buildAnimationAst} from '../dsl/animation_ast_builder';\nimport {AnimationTrigger, buildTrigger} from '../dsl/animation_trigger';\nimport {AnimationStyleNormalizer} from '../dsl/style_normalization/animation_style_normalizer';\n\nimport {AnimationDriver} from './animation_driver';\nimport {parseTimelineCommand} from './shared';\nimport {TimelineAnimationEngine} from './timeline_animation_engine';\nimport {TransitionAnimationEngine} from './transition_animation_engine';\n\nexport class AnimationEngine {\n  private _transitionEngine: TransitionAnimationEngine;\n  private _timelineEngine: TimelineAnimationEngine;\n\n  private _triggerCache: {[key: string]: AnimationTrigger} = {};\n\n  // this method is designed to be overridden by the code that uses this engine\n  public onRemovalComplete = (element: any, context: any) => {};\n\n  constructor(\n      private bodyNode: any, private _driver: AnimationDriver,\n      normalizer: AnimationStyleNormalizer) {\n    this._transitionEngine = new TransitionAnimationEngine(bodyNode, _driver, normalizer);\n    this._timelineEngine = new TimelineAnimationEngine(bodyNode, _driver, normalizer);\n\n    this._transitionEngine.onRemovalComplete = (element: any, context: any) =>\n        this.onRemovalComplete(element, context);\n  }\n\n  registerTrigger(\n      componentId: string, namespaceId: string, hostElement: any, name: string,\n      metadata: AnimationTriggerMetadata): void {\n    const cacheKey = componentId + '-' + name;\n    let trigger = this._triggerCache[cacheKey];\n    if (!trigger) {\n      const errors: any[] = [];\n      const ast =\n          buildAnimationAst(this._driver, metadata as AnimationMetadata, errors) as TriggerAst;\n      if (errors.length) {\n        throw new Error(\n            `The animation trigger \"${name}\" has failed to build due to the following errors:\\n - ${errors.join(\"\\n - \")}`);\n      }\n      trigger = buildTrigger(name, ast);\n      this._triggerCache[cacheKey] = trigger;\n    }\n    this._transitionEngine.registerTrigger(namespaceId, name, trigger);\n  }\n\n  register(namespaceId: string, hostElement: any) {\n    this._transitionEngine.register(namespaceId, hostElement);\n  }\n\n  destroy(namespaceId: string, context: any) {\n    this._transitionEngine.destroy(namespaceId, context);\n  }\n\n  onInsert(namespaceId: string, element: any, parent: any, insertBefore: boolean): void {\n    this._transitionEngine.insertNode(namespaceId, element, parent, insertBefore);\n  }\n\n  onRemove(namespaceId: string, element: any, context: any): void {\n    this._transitionEngine.removeNode(namespaceId, element, context);\n  }\n\n  disableAnimations(element: any, disable: boolean) {\n    this._transitionEngine.markElementAsDisabled(element, disable);\n  }\n\n  process(namespaceId: string, element: any, property: string, value: any) {\n    if (property.charAt(0) == '@') {\n      const [id, action] = parseTimelineCommand(property);\n      const args = value as any[];\n      this._timelineEngine.command(id, element, action, args);\n    } else {\n      this._transitionEngine.trigger(namespaceId, element, property, value);\n    }\n  }\n\n  listen(\n      namespaceId: string, element: any, eventName: string, eventPhase: string,\n      callback: (event: any) => any): () => any {\n    // @@listen\n    if (eventName.charAt(0) == '@') {\n      const [id, action] = parseTimelineCommand(eventName);\n      return this._timelineEngine.listen(id, element, action, callback);\n    }\n    return this._transitionEngine.listen(namespaceId, element, eventName, eventPhase, callback);\n  }\n\n  flush(microtaskId: number = -1): void { this._transitionEngine.flush(microtaskId); }\n\n  get players(): AnimationPlayer[] {\n    return (this._transitionEngine.players as AnimationPlayer[])\n        .concat(this._timelineEngine.players as AnimationPlayer[]);\n  }\n\n  whenRenderingDone(): Promise<any> { return this._transitionEngine.whenRenderingDone(); }\n}\n"]}