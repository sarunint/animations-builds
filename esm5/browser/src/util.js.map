{"version":3,"file":"util.js","sourceRoot":"","sources":["../../../../../../packages/animations/browser/src/util.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimateTimings, AnimationMetadata, AnimationMetadataType, AnimationOptions, sequence, ÉµStyleData} from '@angular/animations';\nimport {Ast as AnimationAst, AstVisitor as AnimationAstVisitor} from './dsl/animation_ast';\nimport {AnimationDslVisitor} from './dsl/animation_dsl_visitor';\nimport {isNode} from './render/shared';\n\nexport const ONE_SECOND = 1000;\n\nexport const SUBSTITUTION_EXPR_START = '{{';\nexport const SUBSTITUTION_EXPR_END = '}}';\nexport const ENTER_CLASSNAME = 'ng-enter';\nexport const LEAVE_CLASSNAME = 'ng-leave';\nexport const ENTER_SELECTOR = '.ng-enter';\nexport const LEAVE_SELECTOR = '.ng-leave';\nexport const NG_TRIGGER_CLASSNAME = 'ng-trigger';\nexport const NG_TRIGGER_SELECTOR = '.ng-trigger';\nexport const NG_ANIMATING_CLASSNAME = 'ng-animating';\nexport const NG_ANIMATING_SELECTOR = '.ng-animating';\n\nexport function resolveTimingValue(value: string | number) {\n  if (typeof value == 'number') return value;\n\n  const matches = (value as string).match(/^(-?[\\.\\d]+)(m?s)/);\n  if (!matches || matches.length < 2) return 0;\n\n  return _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);\n}\n\nfunction _convertTimeValueToMS(value: number, unit: string): number {\n  switch (unit) {\n    case 's':\n      return value * ONE_SECOND;\n    default:  // ms or something else\n      return value;\n  }\n}\n\nexport function resolveTiming(\n    timings: string | number | AnimateTimings, errors: any[], allowNegativeValues?: boolean) {\n  return timings.hasOwnProperty('duration') ?\n      <AnimateTimings>timings :\n      parseTimeExpression(<string|number>timings, errors, allowNegativeValues);\n}\n\nfunction parseTimeExpression(\n    exp: string | number, errors: string[], allowNegativeValues?: boolean): AnimateTimings {\n  const regex = /^(-?[\\.\\d]+)(m?s)(?:\\s+(-?[\\.\\d]+)(m?s))?(?:\\s+([-a-z]+(?:\\(.+?\\))?))?$/i;\n  let duration: number;\n  let delay: number = 0;\n  let easing: string = '';\n  if (typeof exp === 'string') {\n    const matches = exp.match(regex);\n    if (matches === null) {\n      errors.push(`The provided timing value \"${exp}\" is invalid.`);\n      return {duration: 0, delay: 0, easing: ''};\n    }\n\n    duration = _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);\n\n    const delayMatch = matches[3];\n    if (delayMatch != null) {\n      delay = _convertTimeValueToMS(Math.floor(parseFloat(delayMatch)), matches[4]);\n    }\n\n    const easingVal = matches[5];\n    if (easingVal) {\n      easing = easingVal;\n    }\n  } else {\n    duration = <number>exp;\n  }\n\n  if (!allowNegativeValues) {\n    let containsErrors = false;\n    let startIndex = errors.length;\n    if (duration < 0) {\n      errors.push(`Duration values below 0 are not allowed for this animation step.`);\n      containsErrors = true;\n    }\n    if (delay < 0) {\n      errors.push(`Delay values below 0 are not allowed for this animation step.`);\n      containsErrors = true;\n    }\n    if (containsErrors) {\n      errors.splice(startIndex, 0, `The provided timing value \"${exp}\" is invalid.`);\n    }\n  }\n\n  return {duration, delay, easing};\n}\n\nexport function copyObj(\n    obj: {[key: string]: any}, destination: {[key: string]: any} = {}): {[key: string]: any} {\n  Object.keys(obj).forEach(prop => { destination[prop] = obj[prop]; });\n  return destination;\n}\n\nexport function normalizeStyles(styles: ÉµStyleData | ÉµStyleData[]): ÉµStyleData {\n  const normalizedStyles: ÉµStyleData = {};\n  if (Array.isArray(styles)) {\n    styles.forEach(data => copyStyles(data, false, normalizedStyles));\n  } else {\n    copyStyles(styles, false, normalizedStyles);\n  }\n  return normalizedStyles;\n}\n\nexport function copyStyles(\n    styles: ÉµStyleData, readPrototype: boolean, destination: ÉµStyleData = {}): ÉµStyleData {\n  if (readPrototype) {\n    // we make use of a for-in loop so that the\n    // prototypically inherited properties are\n    // revealed from the backFill map\n    for (let prop in styles) {\n      destination[prop] = styles[prop];\n    }\n  } else {\n    copyObj(styles, destination);\n  }\n  return destination;\n}\n\nfunction getStyleAttributeString(element: any, key: string, value: string) {\n  // Return the key-value pair string to be added to the style attribute for the\n  // given CSS style key.\n  if (value) {\n    return key + ':' + value + ';';\n  } else {\n    return '';\n  }\n}\n\nfunction writeStyleAttribute(element: any) {\n  // Read the style property of the element and manually reflect it to the\n  // style attribute. This is needed because Domino on platform-server doesn't\n  // understand the full set of allowed CSS properties and doesn't reflect some\n  // of them automatically.\n  let styleAttrValue = '';\n  for (let i = 0; i < element.style.length; i++) {\n    const key = element.style.item(i);\n    styleAttrValue += getStyleAttributeString(element, key, element.style.getPropertyValue(key));\n  }\n  for (const key in element.style) {\n    // Skip internal Domino properties that don't need to be reflected.\n    if (!element.style.hasOwnProperty(key) || key.startsWith('_')) {\n      continue;\n    }\n    const dashKey = camelCaseToDashCase(key);\n    styleAttrValue += getStyleAttributeString(element, dashKey, element.style[key]);\n  }\n  element.setAttribute('style', styleAttrValue);\n}\n\nexport function setStyles(element: any, styles: ÉµStyleData) {\n  if (element['style']) {\n    Object.keys(styles).forEach(prop => {\n      const camelProp = dashCaseToCamelCase(prop);\n      element.style[camelProp] = styles[prop];\n    });\n    // On the server set the 'style' attribute since it's not automatically reflected.\n    if (isNode()) {\n      writeStyleAttribute(element);\n    }\n  }\n}\n\nexport function eraseStyles(element: any, styles: ÉµStyleData) {\n  if (element['style']) {\n    Object.keys(styles).forEach(prop => {\n      const camelProp = dashCaseToCamelCase(prop);\n      element.style[camelProp] = '';\n    });\n    // On the server set the 'style' attribute since it's not automatically reflected.\n    if (isNode()) {\n      writeStyleAttribute(element);\n    }\n  }\n}\n\nexport function normalizeAnimationEntry(steps: AnimationMetadata | AnimationMetadata[]):\n    AnimationMetadata {\n  if (Array.isArray(steps)) {\n    if (steps.length == 1) return steps[0];\n    return sequence(steps);\n  }\n  return steps as AnimationMetadata;\n}\n\nexport function validateStyleParams(\n    value: string | number, options: AnimationOptions, errors: any[]) {\n  const params = options.params || {};\n  const matches = extractStyleParams(value);\n  if (matches.length) {\n    matches.forEach(varName => {\n      if (!params.hasOwnProperty(varName)) {\n        errors.push(\n            `Unable to resolve the local animation param ${varName} in the given list of values`);\n      }\n    });\n  }\n}\n\nconst PARAM_REGEX =\n    new RegExp(`${SUBSTITUTION_EXPR_START}\\\\s*(.+?)\\\\s*${SUBSTITUTION_EXPR_END}`, 'g');\nexport function extractStyleParams(value: string | number): string[] {\n  let params: string[] = [];\n  if (typeof value === 'string') {\n    const val = value.toString();\n\n    let match: any;\n    while (match = PARAM_REGEX.exec(val)) {\n      params.push(match[1] as string);\n    }\n    PARAM_REGEX.lastIndex = 0;\n  }\n  return params;\n}\n\nexport function interpolateParams(\n    value: string | number, params: {[name: string]: any}, errors: any[]): string|number {\n  const original = value.toString();\n  const str = original.replace(PARAM_REGEX, (_, varName) => {\n    let localVal = params[varName];\n    // this means that the value was never overridden by the data passed in by the user\n    if (!params.hasOwnProperty(varName)) {\n      errors.push(`Please provide a value for the animation param ${varName}`);\n      localVal = '';\n    }\n    return localVal.toString();\n  });\n\n  // we do this to assert that numeric values stay as they are\n  return str == original ? value : str;\n}\n\nexport function iteratorToArray(iterator: any): any[] {\n  const arr: any[] = [];\n  let item = iterator.next();\n  while (!item.done) {\n    arr.push(item.value);\n    item = iterator.next();\n  }\n  return arr;\n}\n\nexport function mergeAnimationOptions(\n    source: AnimationOptions, destination: AnimationOptions): AnimationOptions {\n  if (source.params) {\n    const p0 = source.params;\n    if (!destination.params) {\n      destination.params = {};\n    }\n    const p1 = destination.params;\n    Object.keys(p0).forEach(param => {\n      if (!p1.hasOwnProperty(param)) {\n        p1[param] = p0[param];\n      }\n    });\n  }\n  return destination;\n}\n\nconst DASH_CASE_REGEXP = /-+([a-z0-9])/g;\nexport function dashCaseToCamelCase(input: string): string {\n  return input.replace(DASH_CASE_REGEXP, (...m: any[]) => m[1].toUpperCase());\n}\n\nfunction camelCaseToDashCase(input: string): string {\n  return input.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n}\n\nexport function allowPreviousPlayerStylesMerge(duration: number, delay: number) {\n  return duration === 0 || delay === 0;\n}\n\nexport function balancePreviousStylesIntoKeyframes(\n    element: any, keyframes: {[key: string]: any}[], previousStyles: {[key: string]: any}) {\n  const previousStyleProps = Object.keys(previousStyles);\n  if (previousStyleProps.length && keyframes.length) {\n    let startingKeyframe = keyframes[0];\n    let missingStyleProps: string[] = [];\n    previousStyleProps.forEach(prop => {\n      if (!startingKeyframe.hasOwnProperty(prop)) {\n        missingStyleProps.push(prop);\n      }\n      startingKeyframe[prop] = previousStyles[prop];\n    });\n\n    if (missingStyleProps.length) {\n      // tslint:disable-next-line\n      for (var i = 1; i < keyframes.length; i++) {\n        let kf = keyframes[i];\n        missingStyleProps.forEach(function(prop) { kf[prop] = computeStyle(element, prop); });\n      }\n    }\n  }\n  return keyframes;\n}\n\nexport function visitDslNode(\n    visitor: AnimationDslVisitor, node: AnimationMetadata, context: any): any;\nexport function visitDslNode(\n    visitor: AnimationAstVisitor, node: AnimationAst<AnimationMetadataType>, context: any): any;\nexport function visitDslNode(visitor: any, node: any, context: any): any {\n  switch (node.type) {\n    case AnimationMetadataType.Trigger:\n      return visitor.visitTrigger(node, context);\n    case AnimationMetadataType.State:\n      return visitor.visitState(node, context);\n    case AnimationMetadataType.Transition:\n      return visitor.visitTransition(node, context);\n    case AnimationMetadataType.Sequence:\n      return visitor.visitSequence(node, context);\n    case AnimationMetadataType.Group:\n      return visitor.visitGroup(node, context);\n    case AnimationMetadataType.Animate:\n      return visitor.visitAnimate(node, context);\n    case AnimationMetadataType.Keyframes:\n      return visitor.visitKeyframes(node, context);\n    case AnimationMetadataType.Style:\n      return visitor.visitStyle(node, context);\n    case AnimationMetadataType.Reference:\n      return visitor.visitReference(node, context);\n    case AnimationMetadataType.AnimateChild:\n      return visitor.visitAnimateChild(node, context);\n    case AnimationMetadataType.AnimateRef:\n      return visitor.visitAnimateRef(node, context);\n    case AnimationMetadataType.Query:\n      return visitor.visitQuery(node, context);\n    case AnimationMetadataType.Stagger:\n      return visitor.visitStagger(node, context);\n    default:\n      throw new Error(`Unable to resolve animation metadata node #${node.type}`);\n  }\n}\n\nexport function computeStyle(element: any, prop: string): string {\n  return (<any>window.getComputedStyle(element))[prop];\n}\n"]}