{"version":3,"file":"shared.js","sourceRoot":"","sources":["../../../../../../packages/animations/browser/src/render/shared.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AUTO_STYLE, AnimationEvent, AnimationPlayer, NoopAnimationPlayer, ɵAnimationGroupPlayer, ɵPRE_STYLE as PRE_STYLE, ɵStyleData} from '@angular/animations';\n\nimport {AnimationStyleNormalizer} from '../../src/dsl/style_normalization/animation_style_normalizer';\nimport {AnimationDriver} from '../../src/render/animation_driver';\n\n// We don't include ambient node types here since @angular/animations/browser\n// is meant to target the browser so technically it should not depend on node\n// types. `process` is just declared locally here as a result.\ndeclare const process: any;\n\nexport function isBrowser() {\n  return (typeof window !== 'undefined' && typeof window.document !== 'undefined');\n}\n\nexport function isNode() {\n  return (typeof process !== 'undefined');\n}\n\nexport function optimizeGroupPlayer(players: AnimationPlayer[]): AnimationPlayer {\n  switch (players.length) {\n    case 0:\n      return new NoopAnimationPlayer();\n    case 1:\n      return players[0];\n    default:\n      return new ɵAnimationGroupPlayer(players);\n  }\n}\n\nexport function normalizeKeyframes(\n    driver: AnimationDriver, normalizer: AnimationStyleNormalizer, element: any,\n    keyframes: ɵStyleData[], preStyles: ɵStyleData = {},\n    postStyles: ɵStyleData = {}): ɵStyleData[] {\n  const errors: string[] = [];\n  const normalizedKeyframes: ɵStyleData[] = [];\n  let previousOffset = -1;\n  let previousKeyframe: ɵStyleData|null = null;\n  keyframes.forEach(kf => {\n    const offset = kf['offset'] as number;\n    const isSameOffset = offset == previousOffset;\n    const normalizedKeyframe: ɵStyleData = (isSameOffset && previousKeyframe) || {};\n    Object.keys(kf).forEach(prop => {\n      let normalizedProp = prop;\n      let normalizedValue = kf[prop];\n      if (prop !== 'offset') {\n        normalizedProp = normalizer.normalizePropertyName(normalizedProp, errors);\n        switch (normalizedValue) {\n          case PRE_STYLE:\n            normalizedValue = preStyles[prop];\n            break;\n\n          case AUTO_STYLE:\n            normalizedValue = postStyles[prop];\n            break;\n\n          default:\n            normalizedValue =\n                normalizer.normalizeStyleValue(prop, normalizedProp, normalizedValue, errors);\n            break;\n        }\n      }\n      normalizedKeyframe[normalizedProp] = normalizedValue;\n    });\n    if (!isSameOffset) {\n      normalizedKeyframes.push(normalizedKeyframe);\n    }\n    previousKeyframe = normalizedKeyframe;\n    previousOffset = offset;\n  });\n  if (errors.length) {\n    const LINE_START = '\\n - ';\n    throw new Error(\n        `Unable to animate due to the following errors:${LINE_START}${errors.join(LINE_START)}`);\n  }\n\n  return normalizedKeyframes;\n}\n\nexport function listenOnPlayer(\n    player: AnimationPlayer, eventName: string, event: AnimationEvent | undefined,\n    callback: (event: any) => any) {\n  switch (eventName) {\n    case 'start':\n      player.onStart(() => callback(event && copyAnimationEvent(event, 'start', player)));\n      break;\n    case 'done':\n      player.onDone(() => callback(event && copyAnimationEvent(event, 'done', player)));\n      break;\n    case 'destroy':\n      player.onDestroy(() => callback(event && copyAnimationEvent(event, 'destroy', player)));\n      break;\n  }\n}\n\nexport function copyAnimationEvent(\n    e: AnimationEvent, phaseName: string, player: AnimationPlayer): AnimationEvent {\n  const totalTime = player.totalTime;\n  const disabled = (player as any).disabled ? true : false;\n  const event = makeAnimationEvent(\n      e.element, e.triggerName, e.fromState, e.toState, phaseName || e.phaseName,\n      totalTime == undefined ? e.totalTime : totalTime, disabled);\n  const data = (e as any)['_data'];\n  if (data != null) {\n    (event as any)['_data'] = data;\n  }\n  return event;\n}\n\nexport function makeAnimationEvent(\n    element: any, triggerName: string, fromState: string, toState: string, phaseName: string = '',\n    totalTime: number = 0, disabled?: boolean): AnimationEvent {\n  return {element, triggerName, fromState, toState, phaseName, totalTime, disabled: !!disabled};\n}\n\nexport function getOrSetAsInMap(\n    map: Map<any, any>| {[key: string]: any}, key: any, defaultValue: any) {\n  let value: any;\n  if (map instanceof Map) {\n    value = map.get(key);\n    if (!value) {\n      map.set(key, value = defaultValue);\n    }\n  } else {\n    value = map[key];\n    if (!value) {\n      value = map[key] = defaultValue;\n    }\n  }\n  return value;\n}\n\nexport function parseTimelineCommand(command: string): [string, string] {\n  const separatorPos = command.indexOf(':');\n  const id = command.substring(1, separatorPos);\n  const action = command.substr(separatorPos + 1);\n  return [id, action];\n}\n\nlet _contains: (elm1: any, elm2: any) => boolean = (elm1: any, elm2: any) => false;\nlet _matches: (element: any, selector: string) => boolean = (element: any, selector: string) =>\n    false;\nlet _query: (element: any, selector: string, multi: boolean) => any[] =\n    (element: any, selector: string, multi: boolean) => {\n      return [];\n    };\n\n// Define utility methods for browsers and platform-server(domino) where Element\n// and utility methods exist.\nconst _isNode = isNode();\nif (_isNode || typeof Element !== 'undefined') {\n  // this is well supported in all browsers\n  _contains = (elm1: any, elm2: any) => { return elm1.contains(elm2) as boolean; };\n\n  if (_isNode || Element.prototype.matches) {\n    _matches = (element: any, selector: string) => element.matches(selector);\n  } else {\n    const proto = Element.prototype as any;\n    const fn = proto.matchesSelector || proto.mozMatchesSelector || proto.msMatchesSelector ||\n        proto.oMatchesSelector || proto.webkitMatchesSelector;\n    if (fn) {\n      _matches = (element: any, selector: string) => fn.apply(element, [selector]);\n    }\n  }\n\n  _query = (element: any, selector: string, multi: boolean): any[] => {\n    let results: any[] = [];\n    if (multi) {\n      results.push(...element.querySelectorAll(selector));\n    } else {\n      const elm = element.querySelector(selector);\n      if (elm) {\n        results.push(elm);\n      }\n    }\n    return results;\n  };\n}\n\nfunction containsVendorPrefix(prop: string): boolean {\n  // Webkit is the only real popular vendor prefix nowadays\n  // cc: http://shouldiprefix.com/\n  return prop.substring(1, 6) == 'ebkit';  // webkit or Webkit\n}\n\nlet _CACHED_BODY: {style: any}|null = null;\nlet _IS_WEBKIT = false;\nexport function validateStyleProperty(prop: string): boolean {\n  if (!_CACHED_BODY) {\n    _CACHED_BODY = getBodyNode() || {};\n    _IS_WEBKIT = _CACHED_BODY !.style ? ('WebkitAppearance' in _CACHED_BODY !.style) : false;\n  }\n\n  let result = true;\n  if (_CACHED_BODY !.style && !containsVendorPrefix(prop)) {\n    result = prop in _CACHED_BODY !.style;\n    if (!result && _IS_WEBKIT) {\n      const camelProp = 'Webkit' + prop.charAt(0).toUpperCase() + prop.substr(1);\n      result = camelProp in _CACHED_BODY !.style;\n    }\n  }\n\n  return result;\n}\n\nexport function getBodyNode(): any|null {\n  if (typeof document != 'undefined') {\n    return document.body;\n  }\n  return null;\n}\n\nexport const matchesElement = _matches;\nexport const containsElement = _contains;\nexport const invokeQuery = _query;\n\nexport function hypenatePropsObject(object: {[key: string]: any}): {[key: string]: any} {\n  const newObj: {[key: string]: any} = {};\n  Object.keys(object).forEach(prop => {\n    const newProp = prop.replace(/([a-z])([A-Z])/g, '$1-$2');\n    newObj[newProp] = object[prop];\n  });\n  return newObj;\n}\n"]}