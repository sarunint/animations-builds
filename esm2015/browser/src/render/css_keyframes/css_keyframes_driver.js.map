{"version":3,"file":"css_keyframes_driver.js","sourceRoot":"","sources":["../../../../../../../packages/animations/browser/src/render/css_keyframes/css_keyframes_driver.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimationPlayer, ɵStyleData} from '@angular/animations';\n\nimport {allowPreviousPlayerStylesMerge, balancePreviousStylesIntoKeyframes, computeStyle} from '../../util';\nimport {AnimationDriver} from '../animation_driver';\nimport {containsElement, hypenatePropsObject, invokeQuery, matchesElement, validateStyleProperty} from '../shared';\n\nimport {CssKeyframesPlayer} from './css_keyframes_player';\nimport {DirectStylePlayer} from './direct_style_player';\n\nconst KEYFRAMES_NAME_PREFIX = 'gen_css_kf_';\nconst TAB_SPACE = ' ';\n\nexport class CssKeyframesDriver implements AnimationDriver {\n  private _count = 0;\n  private readonly _head: any = document.querySelector('head');\n  private _warningIssued = false;\n\n  validateStyleProperty(prop: string): boolean { return validateStyleProperty(prop); }\n\n  matchesElement(element: any, selector: string): boolean {\n    return matchesElement(element, selector);\n  }\n\n  containsElement(elm1: any, elm2: any): boolean { return containsElement(elm1, elm2); }\n\n  query(element: any, selector: string, multi: boolean): any[] {\n    return invokeQuery(element, selector, multi);\n  }\n\n  computeStyle(element: any, prop: string, defaultValue?: string): string {\n    return (window.getComputedStyle(element) as any)[prop] as string;\n  }\n\n  buildKeyframeElement(element: any, name: string, keyframes: {[key: string]: any}[]): any {\n    keyframes = keyframes.map(kf => hypenatePropsObject(kf));\n    let keyframeStr = `@keyframes ${name} {\\n`;\n    let tab = '';\n    keyframes.forEach(kf => {\n      tab = TAB_SPACE;\n      const offset = parseFloat(kf.offset);\n      keyframeStr += `${tab}${offset * 100}% {\\n`;\n      tab += TAB_SPACE;\n      Object.keys(kf).forEach(prop => {\n        const value = kf[prop];\n        switch (prop) {\n          case 'offset':\n            return;\n          case 'easing':\n            if (value) {\n              keyframeStr += `${tab}animation-timing-function: ${value};\\n`;\n            }\n            return;\n          default:\n            keyframeStr += `${tab}${prop}: ${value};\\n`;\n            return;\n        }\n      });\n      keyframeStr += `${tab}}\\n`;\n    });\n    keyframeStr += `}\\n`;\n\n    const kfElm = document.createElement('style');\n    kfElm.innerHTML = keyframeStr;\n    return kfElm;\n  }\n\n  animate(\n      element: any, keyframes: ɵStyleData[], duration: number, delay: number, easing: string,\n      previousPlayers: AnimationPlayer[] = [], scrubberAccessRequested?: boolean): AnimationPlayer {\n    if (scrubberAccessRequested) {\n      this._notifyFaultyScrubber();\n    }\n\n    const previousCssKeyframePlayers = <CssKeyframesPlayer[]>previousPlayers.filter(\n        player => player instanceof CssKeyframesPlayer);\n\n    const previousStyles: {[key: string]: any} = {};\n\n    if (allowPreviousPlayerStylesMerge(duration, delay)) {\n      previousCssKeyframePlayers.forEach(player => {\n        let styles = player.currentSnapshot;\n        Object.keys(styles).forEach(prop => previousStyles[prop] = styles[prop]);\n      });\n    }\n\n    keyframes = balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles);\n    const finalStyles = flattenKeyframesIntoStyles(keyframes);\n\n    // if there is no animation then there is no point in applying\n    // styles and waiting for an event to get fired. This causes lag.\n    // It's better to just directly apply the styles to the element\n    // via the direct styling animation player.\n    if (duration == 0) {\n      return new DirectStylePlayer(element, finalStyles);\n    }\n\n    const animationName = `${KEYFRAMES_NAME_PREFIX}${this._count++}`;\n    const kfElm = this.buildKeyframeElement(element, animationName, keyframes);\n    document.querySelector('head') !.appendChild(kfElm);\n\n    const player = new CssKeyframesPlayer(\n        element, keyframes, animationName, duration, delay, easing, finalStyles);\n\n    player.onDestroy(() => removeElement(kfElm));\n    return player;\n  }\n\n  private _notifyFaultyScrubber() {\n    if (!this._warningIssued) {\n      console.warn(\n          '@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\\n',\n          '  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill.');\n      this._warningIssued = true;\n    }\n  }\n}\n\nfunction flattenKeyframesIntoStyles(\n    keyframes: null | {[key: string]: any} | {[key: string]: any}[]): {[key: string]: any} {\n  let flatKeyframes: {[key: string]: any} = {};\n  if (keyframes) {\n    const kfs = Array.isArray(keyframes) ? keyframes : [keyframes];\n    kfs.forEach(kf => {\n      Object.keys(kf).forEach(prop => {\n        if (prop == 'offset' || prop == 'easing') return;\n        flatKeyframes[prop] = kf[prop];\n      });\n    });\n  }\n  return flatKeyframes;\n}\n\nfunction removeElement(node: any) {\n  node.parentNode.removeChild(node);\n}\n"]}